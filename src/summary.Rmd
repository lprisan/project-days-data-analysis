---
title: "Processing Observation Data from Learning Experiments"
author: "Lewis Marsh"
date: "06/06/2018"
output: pdf_document
---

```{r setup, include=FALSE, code=readLines("processObservationData.R")}
knitr::opts_chunk$set(echo = TRUE)
#read_chunk("processObservationData.R")
library(gsheet)

raw_data <- as.data.frame(gsheet2tbl("https://docs.google.com/spreadsheets/d/11BPHcSlqwozx3ffOQhQ5i5O8TRVa8xKoaw2uiny8k5A/edit"))
```

This R Markdown report aims to summarise the R script `processObservationData.R`. It consists of two main
functions, `processObservationData` and `processAllObservationData`.

## Processing a Single Data Set

The first of these two functions,
```{}
processObservationData(data,
                       date=as.POSIXct(strptime("10-01-2018", "%d-%m-%Y")),
                       project="Isle", 
                       activitycol=F,
                       observercol=F,
                       namecols=c("timestamp","group",
                            "StudentA","StudentB","StudentC","StudentD")),
```
takes in a dataframe together with some other parameters and returns a cleaned data frame.

In the orginal data sheets, each entry lists the observation for a whole group of students (between 3 and 6
usually) and the observations are listed as a piece of (predefined) text, such as "Talking with their group peers
to solve the task" or "Totally disengaged".

In the output this is broken up into individual entries for each student, for which a student variable is
introduced. Furthermore, each possible observation is turned into a boolean variable for each of these entries,
which makes it easier to conduct further statistical analysis of the dataset. Also, a column
with additional notes from the original dataframe is dropped in the output, as it is difficult to make use of
in a statistical test, and a global ID is created for each student, using the date, group, student number in the
group and the project name. This will be of use when merging several datasets with the second function.

As students undertook several tastks in some of the experiments/projects, the input variable "activitycol" indicates whether the function has to look for an extra activity column in the input data. This will be taken over
one-to-one in the output or will be filled in with "Standard" if there was only one activity.
Similarly, in some projects there were more than one observer placed onto each group to enable to test the
reliability of the observers and the data they produce. The variable "observercol" tells the function whether
there is a separate observer column to take over from the input data. Otherwise "1-A" is filled in for each
observer.

## Processing and Merging of Several Data Sets

The second function, `processAllObservationData` takes in a vector of URLs in which the GoogleDocs
containing the experimental data are stored in. It reads the data from the online sheets and places
them in a dataframe. By examining the names of the columns in the dataframe, it detects whether there
are activity or observation columns. By inspecting the first time stamp, it determines the date of the experiment.
It then cleans the data using the first function and adds it to the end of a larger dataframe which
eventually gets returned after the function has iterated through all URLs.

## Example of Output
To exhibit what the functions do, there is a brief example. We are given a data frame taken from
one of the GoogleDocs:
```{r first, include=FALSE}
raw_data <- as.data.frame(gsheet2tbl("https://docs.google.com/spreadsheets/d/11BPHcSlqwozx3ffOQhQ5i5O8TRVa8xKoaw2uiny8k5A/edit"))
```
```{r second}
raw_data[1,1:2]
raw_data[1,3]
```

These are only two snippets of the data, as anything else would not fit onto this page.
We see that the first two columns give a timestamp and the group. We furthermore see the oberservation for
student A. There are 3 other students in the group with individual columns as well as
a column for further comments.

By applying the `processObservationData` function, we then see how the student variable is created
and the observations are turned from text into boolean values. Furthermore, the activity and
observer column have been created which makes it easier to merge and compare this data with other datasets.
```{r third}
processed_data <- processObservationData(raw_data)
summary(processed_data)
str(processed_data)
```

